{"ast":null,"code":"import axios from 'axios';\nimport { addFile, deleteFileAction, setFiles } from \"../reducers/fileReducer\";\nimport { addUploadFile, changeUploadFile, showUploader } from \"../reducers/uploadReducer\";\nimport { hideLoader, showLoader } from \"../reducers/appReducer\";\nimport { API_URL } from \"../config\";\nexport function getFiles(dirId, sort) {\n  return async dispatch => {\n    try {\n      dispatch(showLoader());\n      let url = `${API_URL}api/files`;\n      if (dirId) {\n        url = `${API_URL}api/files?parent=${dirId}`;\n      }\n      if (sort) {\n        url = `${API_URL}api/files?sort=${sort}`;\n      }\n      if (dirId && sort) {\n        url = `${API_URL}api/files?parent=${dirId}&sort=${sort}`;\n      }\n      const response = await axios.get(url, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    } finally {\n      dispatch(hideLoader());\n    }\n  };\n}\nexport function createDir(dirId, name) {\n  return async dispatch => {\n    try {\n      const response = await axios.post(`${API_URL}api/files`, {\n        name,\n        parent: dirId,\n        type: 'dir'\n      }, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      alert(e.response.data.message);\n    }\n  };\n}\nexport function uploadFile(file, dirId) {\n  return async dispatch => {\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n      if (dirId) {\n        formData.append('parent', dirId);\n      }\n      const uploadFile = {\n        name: file.name,\n        progress: 0,\n        id: Date.now()\n      };\n      dispatch(showUploader());\n      dispatch(addUploadFile(uploadFile));\n      const response = await axios.post(`${API_URL}api/files/upload`, formData, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        },\n        onUploadProgress: progressEvent => {\n          const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\n          if (totalLength) {\n            uploadFile.progress = Math.round(progressEvent.loaded * 100 / totalLength);\n            dispatch(changeUploadFile(uploadFile));\n          }\n        }\n      });\n      dispatch(addFile(response.data));\n    } catch (e) {\n      var _e$response, _e$response$data;\n      alert(e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message);\n    }\n  };\n}\nexport async function downloadFile(file) {\n  const response = await fetch(`${API_URL}api/files/download?id=${file._id}`, {\n    headers: {\n      Authorization: `Bearer ${localStorage.getItem('token')}`\n    }\n  });\n  if (response.status === 200) {\n    const blob = await response.blob();\n    const downloadUrl = window.URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = file.name;\n    document.body.appendChild(link);\n    link.click();\n    link.remove();\n  }\n}\nexport function deleteFile(file) {\n  return async dispatch => {\n    try {\n      const response = await axios.delete(`${API_URL}api/files?id=${file._id}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(deleteFileAction(file._id));\n      alert(response.data.message);\n    } catch (e) {\n      var _e$response2, _e$response2$data;\n      alert(e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message);\n    }\n  };\n}\nexport function searchFiles(search) {\n  return async dispatch => {\n    try {\n      const response = await axios.get(`${API_URL}api/files/search?search=${search}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      dispatch(setFiles(response.data));\n    } catch (e) {\n      var _e$response3, _e$response3$data;\n      alert(e === null || e === void 0 ? void 0 : (_e$response3 = e.response) === null || _e$response3 === void 0 ? void 0 : (_e$response3$data = _e$response3.data) === null || _e$response3$data === void 0 ? void 0 : _e$response3$data.message);\n    } finally {\n      dispatch(hideLoader());\n    }\n  };\n}","map":{"version":3,"names":["axios","addFile","deleteFileAction","setFiles","addUploadFile","changeUploadFile","showUploader","hideLoader","showLoader","API_URL","getFiles","dirId","sort","dispatch","url","response","get","headers","Authorization","localStorage","getItem","data","e","alert","message","createDir","name","post","parent","type","uploadFile","file","formData","FormData","append","progress","id","Date","now","onUploadProgress","progressEvent","totalLength","lengthComputable","total","target","getResponseHeader","Math","round","loaded","_e$response","_e$response$data","downloadFile","fetch","_id","status","blob","downloadUrl","window","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","remove","deleteFile","delete","_e$response2","_e$response2$data","searchFiles","search","_e$response3","_e$response3$data"],"sources":["D:/mern-cloud-disk/cloud-disk/client/src/actions/file.js"],"sourcesContent":["import axios from 'axios'\r\nimport {addFile, deleteFileAction, setFiles} from \"../reducers/fileReducer\";\r\nimport {addUploadFile, changeUploadFile, showUploader} from \"../reducers/uploadReducer\";\r\nimport {hideLoader, showLoader} from \"../reducers/appReducer\";\r\nimport {API_URL} from \"../config\";\r\n\r\nexport function getFiles(dirId, sort) {\r\n    return async dispatch => {\r\n        try {\r\n            dispatch(showLoader())\r\n            let url = `${API_URL}api/files`\r\n            if (dirId) {\r\n                url = `${API_URL}api/files?parent=${dirId}`\r\n            }\r\n            if (sort) {\r\n                url = `${API_URL}api/files?sort=${sort}`\r\n            }\r\n            if (dirId && sort) {\r\n                url = `${API_URL}api/files?parent=${dirId}&sort=${sort}`\r\n            }\r\n            const response = await axios.get(url, {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n            });\r\n            dispatch(setFiles(response.data))\r\n        } catch (e) {\r\n            alert(e.response.data.message)\r\n        } finally {\r\n            dispatch(hideLoader())\r\n        }\r\n    }\r\n}\r\n\r\nexport function createDir(dirId, name) {\r\n    return async dispatch => {\r\n        try {\r\n            const response = await axios.post(`${API_URL}api/files`,{\r\n                name,\r\n                parent: dirId,\r\n                type: 'dir'\r\n            }, {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`}\r\n            })\r\n            dispatch(addFile(response.data))\r\n        } catch (e) {\r\n            alert(e.response.data.message)\r\n        }\r\n    }\r\n}\r\n\r\nexport function uploadFile(file, dirId) {\r\n    return async dispatch => {\r\n        try {\r\n            const formData = new FormData()\r\n            formData.append('file', file)\r\n            if (dirId) {\r\n                formData.append('parent', dirId)\r\n            }\r\n            const uploadFile = {name: file.name, progress: 0, id: Date.now()}\r\n            dispatch(showUploader())\r\n            dispatch(addUploadFile(uploadFile))\r\n            const response = await axios.post(`${API_URL}api/files/upload`, formData, {\r\n                headers: {Authorization: `Bearer ${localStorage.getItem('token')}`},\r\n                onUploadProgress: progressEvent => {\r\n                    const totalLength = progressEvent.lengthComputable ? progressEvent.total : progressEvent.target.getResponseHeader('content-length') || progressEvent.target.getResponseHeader('x-decompressed-content-length');\r\n                    if (totalLength) {\r\n                        uploadFile.progress = Math.round((progressEvent.loaded * 100) / totalLength)\r\n                        dispatch(changeUploadFile(uploadFile))\r\n                    }\r\n                }\r\n            });\r\n            dispatch(addFile(response.data))\r\n        } catch (e) {\r\n            alert(e?.response?.data?.message)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport async function downloadFile(file) {\r\n    const response = await fetch(`${API_URL}api/files/download?id=${file._id}`,{\r\n        headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`\r\n        }\r\n    })\r\n    if (response.status === 200) {\r\n        const blob = await response.blob()\r\n        const downloadUrl = window.URL.createObjectURL(blob)\r\n        const link = document.createElement('a')\r\n        link.href = downloadUrl\r\n        link.download = file.name\r\n        document.body.appendChild(link)\r\n        link.click()\r\n        link.remove()\r\n    }\r\n}\r\n\r\nexport function deleteFile(file) {\r\n    return async dispatch => {\r\n        try {\r\n            const response = await axios.delete(`${API_URL}api/files?id=${file._id}`,{\r\n                headers:{\r\n                    Authorization: `Bearer ${localStorage.getItem('token')}`\r\n                }\r\n            })\r\n            dispatch(deleteFileAction(file._id))\r\n            alert(response.data.message)\r\n        } catch (e) {\r\n            alert(e?.response?.data?.message)\r\n        }\r\n    }\r\n}\r\n\r\nexport function searchFiles(search) {\r\n    return async dispatch => {\r\n        try {\r\n            const response = await axios.get(`${API_URL}api/files/search?search=${search}`,{\r\n                headers:{\r\n                    Authorization: `Bearer ${localStorage.getItem('token')}`\r\n                }\r\n            })\r\n            dispatch(setFiles(response.data))\r\n        } catch (e) {\r\n            alert(e?.response?.data?.message)\r\n        } finally {\r\n            dispatch(hideLoader())\r\n        }\r\n    }\r\n}\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAAQC,OAAO,EAAEC,gBAAgB,EAAEC,QAAQ,QAAO,yBAAyB;AAC3E,SAAQC,aAAa,EAAEC,gBAAgB,EAAEC,YAAY,QAAO,2BAA2B;AACvF,SAAQC,UAAU,EAAEC,UAAU,QAAO,wBAAwB;AAC7D,SAAQC,OAAO,QAAO,WAAW;AAEjC,OAAO,SAASC,QAAQA,CAACC,KAAK,EAAEC,IAAI,EAAE;EAClC,OAAO,MAAMC,QAAQ,IAAI;IACrB,IAAI;MACAA,QAAQ,CAACL,UAAU,CAAC,CAAC,CAAC;MACtB,IAAIM,GAAG,GAAI,GAAEL,OAAQ,WAAU;MAC/B,IAAIE,KAAK,EAAE;QACPG,GAAG,GAAI,GAAEL,OAAQ,oBAAmBE,KAAM,EAAC;MAC/C;MACA,IAAIC,IAAI,EAAE;QACNE,GAAG,GAAI,GAAEL,OAAQ,kBAAiBG,IAAK,EAAC;MAC5C;MACA,IAAID,KAAK,IAAIC,IAAI,EAAE;QACfE,GAAG,GAAI,GAAEL,OAAQ,oBAAmBE,KAAM,SAAQC,IAAK,EAAC;MAC5D;MACA,MAAMG,QAAQ,GAAG,MAAMf,KAAK,CAACgB,GAAG,CAACF,GAAG,EAAE;QAClCG,OAAO,EAAE;UAACC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;QAAC;MACtE,CAAC,CAAC;MACFP,QAAQ,CAACV,QAAQ,CAACY,QAAQ,CAACM,IAAI,CAAC,CAAC;IACrC,CAAC,CAAC,OAAOC,CAAC,EAAE;MACRC,KAAK,CAACD,CAAC,CAACP,QAAQ,CAACM,IAAI,CAACG,OAAO,CAAC;IAClC,CAAC,SAAS;MACNX,QAAQ,CAACN,UAAU,CAAC,CAAC,CAAC;IAC1B;EACJ,CAAC;AACL;AAEA,OAAO,SAASkB,SAASA,CAACd,KAAK,EAAEe,IAAI,EAAE;EACnC,OAAO,MAAMb,QAAQ,IAAI;IACrB,IAAI;MACA,MAAME,QAAQ,GAAG,MAAMf,KAAK,CAAC2B,IAAI,CAAE,GAAElB,OAAQ,WAAU,EAAC;QACpDiB,IAAI;QACJE,MAAM,EAAEjB,KAAK;QACbkB,IAAI,EAAE;MACV,CAAC,EAAE;QACCZ,OAAO,EAAE;UAACC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;QAAC;MACtE,CAAC,CAAC;MACFP,QAAQ,CAACZ,OAAO,CAACc,QAAQ,CAACM,IAAI,CAAC,CAAC;IACpC,CAAC,CAAC,OAAOC,CAAC,EAAE;MACRC,KAAK,CAACD,CAAC,CAACP,QAAQ,CAACM,IAAI,CAACG,OAAO,CAAC;IAClC;EACJ,CAAC;AACL;AAEA,OAAO,SAASM,UAAUA,CAACC,IAAI,EAAEpB,KAAK,EAAE;EACpC,OAAO,MAAME,QAAQ,IAAI;IACrB,IAAI;MACA,MAAMmB,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEH,IAAI,CAAC;MAC7B,IAAIpB,KAAK,EAAE;QACPqB,QAAQ,CAACE,MAAM,CAAC,QAAQ,EAAEvB,KAAK,CAAC;MACpC;MACA,MAAMmB,UAAU,GAAG;QAACJ,IAAI,EAAEK,IAAI,CAACL,IAAI;QAAES,QAAQ,EAAE,CAAC;QAAEC,EAAE,EAAEC,IAAI,CAACC,GAAG,CAAC;MAAC,CAAC;MACjEzB,QAAQ,CAACP,YAAY,CAAC,CAAC,CAAC;MACxBO,QAAQ,CAACT,aAAa,CAAC0B,UAAU,CAAC,CAAC;MACnC,MAAMf,QAAQ,GAAG,MAAMf,KAAK,CAAC2B,IAAI,CAAE,GAAElB,OAAQ,kBAAiB,EAAEuB,QAAQ,EAAE;QACtEf,OAAO,EAAE;UAACC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;QAAC,CAAC;QACnEmB,gBAAgB,EAAEC,aAAa,IAAI;UAC/B,MAAMC,WAAW,GAAGD,aAAa,CAACE,gBAAgB,GAAGF,aAAa,CAACG,KAAK,GAAGH,aAAa,CAACI,MAAM,CAACC,iBAAiB,CAAC,gBAAgB,CAAC,IAAIL,aAAa,CAACI,MAAM,CAACC,iBAAiB,CAAC,+BAA+B,CAAC;UAC9M,IAAIJ,WAAW,EAAE;YACbX,UAAU,CAACK,QAAQ,GAAGW,IAAI,CAACC,KAAK,CAAEP,aAAa,CAACQ,MAAM,GAAG,GAAG,GAAIP,WAAW,CAAC;YAC5E5B,QAAQ,CAACR,gBAAgB,CAACyB,UAAU,CAAC,CAAC;UAC1C;QACJ;MACJ,CAAC,CAAC;MACFjB,QAAQ,CAACZ,OAAO,CAACc,QAAQ,CAACM,IAAI,CAAC,CAAC;IACpC,CAAC,CAAC,OAAOC,CAAC,EAAE;MAAA,IAAA2B,WAAA,EAAAC,gBAAA;MACR3B,KAAK,CAACD,CAAC,aAADA,CAAC,wBAAA2B,WAAA,GAAD3B,CAAC,CAAEP,QAAQ,cAAAkC,WAAA,wBAAAC,gBAAA,GAAXD,WAAA,CAAa5B,IAAI,cAAA6B,gBAAA,uBAAjBA,gBAAA,CAAmB1B,OAAO,CAAC;IACrC;EACJ,CAAC;AACL;AAGA,OAAO,eAAe2B,YAAYA,CAACpB,IAAI,EAAE;EACrC,MAAMhB,QAAQ,GAAG,MAAMqC,KAAK,CAAE,GAAE3C,OAAQ,yBAAwBsB,IAAI,CAACsB,GAAI,EAAC,EAAC;IACvEpC,OAAO,EAAE;MACLC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;IAC3D;EACJ,CAAC,CAAC;EACF,IAAIL,QAAQ,CAACuC,MAAM,KAAK,GAAG,EAAE;IACzB,MAAMC,IAAI,GAAG,MAAMxC,QAAQ,CAACwC,IAAI,CAAC,CAAC;IAClC,MAAMC,WAAW,GAAGC,MAAM,CAACC,GAAG,CAACC,eAAe,CAACJ,IAAI,CAAC;IACpD,MAAMK,IAAI,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACxCF,IAAI,CAACG,IAAI,GAAGP,WAAW;IACvBI,IAAI,CAACI,QAAQ,GAAGjC,IAAI,CAACL,IAAI;IACzBmC,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACN,IAAI,CAAC;IAC/BA,IAAI,CAACO,KAAK,CAAC,CAAC;IACZP,IAAI,CAACQ,MAAM,CAAC,CAAC;EACjB;AACJ;AAEA,OAAO,SAASC,UAAUA,CAACtC,IAAI,EAAE;EAC7B,OAAO,MAAMlB,QAAQ,IAAI;IACrB,IAAI;MACA,MAAME,QAAQ,GAAG,MAAMf,KAAK,CAACsE,MAAM,CAAE,GAAE7D,OAAQ,gBAAesB,IAAI,CAACsB,GAAI,EAAC,EAAC;QACrEpC,OAAO,EAAC;UACJC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;QAC3D;MACJ,CAAC,CAAC;MACFP,QAAQ,CAACX,gBAAgB,CAAC6B,IAAI,CAACsB,GAAG,CAAC,CAAC;MACpC9B,KAAK,CAACR,QAAQ,CAACM,IAAI,CAACG,OAAO,CAAC;IAChC,CAAC,CAAC,OAAOF,CAAC,EAAE;MAAA,IAAAiD,YAAA,EAAAC,iBAAA;MACRjD,KAAK,CAACD,CAAC,aAADA,CAAC,wBAAAiD,YAAA,GAADjD,CAAC,CAAEP,QAAQ,cAAAwD,YAAA,wBAAAC,iBAAA,GAAXD,YAAA,CAAalD,IAAI,cAAAmD,iBAAA,uBAAjBA,iBAAA,CAAmBhD,OAAO,CAAC;IACrC;EACJ,CAAC;AACL;AAEA,OAAO,SAASiD,WAAWA,CAACC,MAAM,EAAE;EAChC,OAAO,MAAM7D,QAAQ,IAAI;IACrB,IAAI;MACA,MAAME,QAAQ,GAAG,MAAMf,KAAK,CAACgB,GAAG,CAAE,GAAEP,OAAQ,2BAA0BiE,MAAO,EAAC,EAAC;QAC3EzD,OAAO,EAAC;UACJC,aAAa,EAAG,UAASC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAE;QAC3D;MACJ,CAAC,CAAC;MACFP,QAAQ,CAACV,QAAQ,CAACY,QAAQ,CAACM,IAAI,CAAC,CAAC;IACrC,CAAC,CAAC,OAAOC,CAAC,EAAE;MAAA,IAAAqD,YAAA,EAAAC,iBAAA;MACRrD,KAAK,CAACD,CAAC,aAADA,CAAC,wBAAAqD,YAAA,GAADrD,CAAC,CAAEP,QAAQ,cAAA4D,YAAA,wBAAAC,iBAAA,GAAXD,YAAA,CAAatD,IAAI,cAAAuD,iBAAA,uBAAjBA,iBAAA,CAAmBpD,OAAO,CAAC;IACrC,CAAC,SAAS;MACNX,QAAQ,CAACN,UAAU,CAAC,CAAC,CAAC;IAC1B;EACJ,CAAC;AACL","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}